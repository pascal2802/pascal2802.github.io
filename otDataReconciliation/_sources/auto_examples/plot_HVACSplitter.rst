
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_HVACSplitter.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        :ref:`Go to the end <sphx_glr_download_auto_examples_plot_HVACSplitter.py>`
        to download the full example code.

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_HVACSplitter.py:


Reconcile data for the HVAC Splitter
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++

.. GENERATED FROM PYTHON SOURCE LINES 5-89



.. rst-class:: sphx-glr-horizontal


    *

      .. image-sg:: /auto_examples/images/sphx_glr_plot_HVACSplitter_001.png
         :alt: Iso-PDF values
         :srcset: /auto_examples/images/sphx_glr_plot_HVACSplitter_001.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/images/sphx_glr_plot_HVACSplitter_002.png
         :alt: Iso-PDF values
         :srcset: /auto_examples/images/sphx_glr_plot_HVACSplitter_002.png
         :class: sphx-glr-multi-img

    *

      .. image-sg:: /auto_examples/images/sphx_glr_plot_HVACSplitter_003.png
         :alt: plot HVACSplitter
         :srcset: /auto_examples/images/sphx_glr_plot_HVACSplitter_003.png
         :class: sphx-glr-multi-img


.. rst-class:: sphx-glr-script-out

 .. code-block:: none

    6x6
    [[ 1   0.5 0   0   0   0   ]
     [ 0.5 1   0   0   0   0   ]
     [ 0   0   1   0   0   0   ]
     [ 0   0   0   1   0   0   ]
     [ 0   0   0   0   1   0   ]
     [ 0   0   0   0   0   1   ]]
      Variable to be Estimated   Initial Measured Value   ...  Result of Local Test   Local Quality  
    0                        Q1                      130  ...                  False          1.63955
    1                        Q2                      210  ...                  False          1.54129
    2                        Q3                      360  ...                  False          1.95260
    3                        T1                       20  ...                  False          3.93282
    4                        T2                       30  ...                  False          5.89163
    5                        T3                       22  ...                  False          5.23419

    [6 rows x 7 columns]
                 Q1          Q2          Q3        T1        T2        T3
    Sxij                                                                 
    Q1    59.507600   20.459700   79.967300  0.205535  0.220526 -0.426061
    Q2    20.459700  141.423000  161.883000 -0.565945 -0.607225  1.173170
    Q3    79.967300  161.883000  241.850000 -0.360411 -0.386699  0.747109
    T1     0.205535   -0.565945   -0.360411  0.079768 -0.010978  0.021209
    T2     0.220526   -0.607225   -0.386699 -0.010978  0.078221  0.022757
    T3    -0.426061    1.173170    0.747109  0.021209  0.022757  0.046034
              Q1        Q2        Q3
    Q1  1.000000  0.223025  0.666581
    Q2  0.223025  1.000000  0.875323
    Q3  0.666581  0.875323  1.000000






|

.. code-block:: Python


    # # Reconciliation de donnée avec OpenModelica et OpenTURNS
    # L'objet est de tester la classe DataReconciliationOM fournissant un wrapper python de la reconciliation de donnée réalisée dans OpenModelica.
    # Les résultats de la réconciliation de données sont accessibles au format OpenTURNS (distribution, matrices) pour être visualisés et utilisés dans des études d'incertitudes (propagation, calage par exemple).

    # Import des modules nécessaires
    import otDataReconciliation as otDataR
    import openturns as ot
    import openturns.viewer as otv
    import matplotlib.pyplot as plt
    from IPython.display import Latex, display
    from IPython import get_ipython
    import os

    # Affichage graphiques en ligne si utilisation Ipython
    try:
        get_ipython().run_line_magic("matplotlib", "inline")
    except:
        pass

    # Le modèle jouet est ici l'exemple d'un gaine de ventilation se séparant
    # $$ Q_3 = Q_1 + Q_2 $$
    # $$ Q_3 c_p T_3 = Q_1 c_p T_1 + Q_2 c_p T_2 $$
    # Les débits sont ici en $m^3.h^{-1}$ et les températures en $degC$
    modelName = "TestDataR_HVACSplitter"

    # Construction de la loi à priori des mesures à réconciliées
    # Une corrélation de 0.5 est spécifiée entre $Q_1$ et $Q_2$
    # Dans le cadre de la réconciliation de donnée mis en oeuvre dans OpenModelica, la loi à priori doit être une loi normale multivariée.
    VarNames = ot.Description(["Q1", "Q2", "Q3", "T1", "T2", "T3"])
    priorMeasurements = ot.Point([130, 210, 360, 20, 30, 22])
    priorMeasurementsStandardDeviation = ot.Point([10, 20, 20, 0.3, 0.3, 0.3])
    correlationMatrix = ot.CorrelationMatrix(
        len(VarNames)
    )  # Initialisé à la matrice identité
    correlationMatrix[0, 1] = 0.5  # Spécification du coefficient de corrélation souhaité
    priorDistribution = ot.Normal(
        priorMeasurements, priorMeasurementsStandardDeviation, correlationMatrix
    )

    # La matrice étant symmétrique, le coefficient [1,0] est automatiquement mis à jour
    display(correlationMatrix)

    # Construction de la classe réconciliation de données
    casePath = "./"
    simuMatPath = "SIMU_MAT_0"
    covarianceMatrix = priorDistribution.getCovariance()
    dataR = otDataR.DataReconciliationOM(
        modelName, VarNames, priorMeasurements, covarianceMatrix, casePath, simuMatPath
    )

    # Visualisation de la distribution multivariée des mesures avant réconciliation
    priorDistribution = dataR.getPriorDistribution()
    grid = priorDistribution.drawDistributionGridPDF()
    fig = otv.View(grid)

    # Lancer la réconciliation de données
    dataR.reconcileData()

    # # Analyse des résultats
    df = dataR.getLocalResultsAsDataFrame()
    display(df)

    # Visualisation de la distribution multivariée des mesures réconciliées, marginales 1D et 2D (visualisation de la dépendance à posteriori)
    posteriorDistribution = dataR.getPosteriorDistribution(index=[0, 1, 2])
    grid = posteriorDistribution.drawDistributionGridPDF()
    fig = otv.View(grid)

    # Il est également possible de récupérer la matrice de covariance à posteriori
    posteriorCovM = dataR.getCovarianceMatrixAsDataFrame()
    display(posteriorCovM)

    # Accès à la matrice de corrélation reconciliée des trois débits
    posteriorCorrelationMatrix = dataR.getPosteriorCorrelationMatrix(index=[0, 1, 2])
    posteriorCorrelationMatrixDF = dataR.getPosteriorCorrelationMatrixAsDataFrame(
        index=[0, 1, 2]
    )
    display(posteriorCorrelationMatrixDF)

    # Visualisation de l'effet de la réconciliation de données sur les marginales
    grid = dataR.drawPriorPosteriorMarginalsDistribution()
    fig = otv.View(grid)

    # Fin


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** (0 minutes 3.175 seconds)


.. _sphx_glr_download_auto_examples_plot_HVACSplitter.py:

.. only:: html

  .. container:: sphx-glr-footer sphx-glr-footer-example

    .. container:: sphx-glr-download sphx-glr-download-jupyter

      :download:`Download Jupyter notebook: plot_HVACSplitter.ipynb <plot_HVACSplitter.ipynb>`

    .. container:: sphx-glr-download sphx-glr-download-python

      :download:`Download Python source code: plot_HVACSplitter.py <plot_HVACSplitter.py>`

    .. container:: sphx-glr-download sphx-glr-download-zip

      :download:`Download zipped: plot_HVACSplitter.zip <plot_HVACSplitter.zip>`
